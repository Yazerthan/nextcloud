"use strict";(()=>{(self.webpackChunktalk=self.webpackChunktalk||[]).push([["files-sidebar-tab-chunk"],{70081:(ze,T,o)=>{o.r(T),o.d(T,{default:()=>Te});var e=o(20641);const z={class:"talk-tab__wrapper"};function $(v,a,d,r,i,u){const f=(0,e.g2)("InternalSignalingHint"),k=(0,e.g2)("CallButton"),y=(0,e.g2)("CallFailedDialog"),c=(0,e.g2)("RouterView"),l=(0,e.g2)("PollManager"),m=(0,e.g2)("PollViewer"),h=(0,e.g2)("MediaSettings");return(0,e.uX)(),(0,e.CE)("div",z,[(0,e.bF)(f),r.isInCall?(0,e.Q3)("",!0):((0,e.uX)(),(0,e.Wv)(k,{key:0,class:"talk-tab__call-button"})),u.connectionFailed?((0,e.uX)(),(0,e.Wv)(y,{key:1,token:r.token},null,8,["token"])):(0,e.Q3)("",!0),(0,e.bF)(c,{class:"talk-tab__chat-view"}),(0,e.bF)(l),(0,e.bF)(m),(0,e.bF)(h,{"recording-consent-given":i.recordingConsentGiven,"onUpdate:recordingConsentGiven":a[0]||(a[0]=M=>i.recordingConsentGiven=M)},null,8,["recording-consent-given"])])}var j=o(67944),J=o(98240),t=o(50953),S=o(40834),P=o(90033),n=o(53334),D=o(15446),L=o(94434),Z=o(4807),_=o(99318),q=o(86097),ee=o(48492),A=o(55031),b=o(72661);const te={key:1,class:"drafts__wrapper"},oe=(0,e.pM)({__name:"PollDraftHandler",props:{token:{},editorOpened:{type:Boolean},container:{}},emits:["close"],setup(v,{emit:a}){const d=v,r=a,i=(0,b.v)();i.getPollDrafts(d.token);const u=(0,e.EW)(()=>i.getDrafts(d.token)),f=(0,e.EW)(()=>i.draftsLoaded(d.token));function k({id:y,action:c}){A.l.emit("poll-editor-open",{token:d.token,id:y,fromDrafts:!d.editorOpened,action:c,selector:d.container})}return(y,c)=>((0,e.uX)(),(0,e.Wv)((0,t.R1)(L.A),{class:"drafts",name:(0,t.R1)(n.t)("spreed","Poll drafts"),container:v.container,size:"normal","close-on-click-outside":"","onUpdate:open":c[1]||(c[1]=l=>r("close"))},(0,e.eX)({default:(0,e.k6)(()=>[u.value.length?((0,e.uX)(),(0,e.CE)("div",te,[((0,e.uX)(!0),(0,e.CE)(e.FK,null,(0,e.pI)(u.value,l=>((0,e.uX)(),(0,e.Wv)(ee.A,{id:l.id.toString(),key:l.id,token:v.token,name:l.question,draft:"",onClick:k},null,8,["id","token","name"]))),128))])):((0,e.uX)(),(0,e.Wv)(q.A,{key:0,class:"drafts__empty",name:f.value?(0,t.R1)(n.t)("spreed","No poll drafts"):(0,t.R1)(n.t)("spreed","Loading \u2026"),description:f.value?(0,t.R1)(n.t)("spreed","There is no poll drafts yet saved for this conversation"):""},{icon:(0,e.k6)(()=>[f.value?((0,e.uX)(),(0,e.Wv)(_.A,{key:0})):((0,e.uX)(),(0,e.Wv)((0,t.R1)(Z.A),{key:1}))]),_:1},8,["name","description"]))]),_:2},[d.editorOpened?void 0:{name:"actions",fn:(0,e.k6)(()=>[(0,e.bF)((0,t.R1)(D.A),{onClick:c[0]||(c[0]=l=>k({id:null,action:"fill"}))},{default:(0,e.k6)(()=>[(0,e.eW)((0,P.v_)((0,t.R1)(n.t)("spreed","Create new poll")),1)]),_:1})]),key:"0"}]),1032,["name","container"]))}});var F=o(66262);const ne=(0,F.A)(oe,[["__scopeId","data-v-31e48ae8"]]);var le=o(85168),x=o(38576),ae=o(5e4),w=o(15797),X=o(86296),H=o(82510),O=o(79455),re=o(15399),se=o(75783),B=o(29503),ie=o(81893),de=o(23179),ue=o(94308),ce=o(27117),V=o(40451),g=o(4133),U=o(97876),pe=o(16506);const ve=["question","options","resultMode","maxVotes"];function fe(v){return Array.isArray(v)&&v.every(a=>typeof a=="string")}function ge(v){if(typeof v!="object"||!v)throw new Error("Invalid parsed object");const a=v;for(const d of ve)if(a[d]===void 0)throw new Error("Missing required key");if(typeof a.question!="string")throw new Error("Invalid parsed value: question");if(typeof a.resultMode!="number"||!(a.resultMode===0||a.resultMode===1))throw new Error("Invalid parsed value: resultMode");if(typeof a.maxVotes!="number")throw new Error("Invalid parsed value: maxVotes");if(!fe(a.options))throw new Error("Invalid parsed value: options");return{question:a.question,options:[...a.options],resultMode:a.resultMode,maxVotes:a.maxVotes}}const me={class:"poll-editor__caption"},ke={class:"poll-editor__wrapper"},Ee={class:"poll-editor__caption"},Pe={class:"poll-editor__caption"},Re={class:"poll-editor__settings"},ye=(0,e.pM)({__name:"PollEditor",props:{token:{},canCreatePollDrafts:{type:Boolean},container:{}},emits:["close"],setup(v,{expose:a,emit:d}){const r=v,i=d;a({fillPollEditorFromDraft:Ue});const u=(0,U.t0)(r.token,"talk-polls-drafts"),f=(0,S.Pj)(),k=(0,b.v)(),y=(0,V.N)(),c=(0,ce.F)(),l=(0,t.KR)(!1),m=(0,t.KR)(null),h=(0,e.rk)("pollOption"),M=(0,t.KR)(null),s=(0,t.Kh)({question:"",options:["",""],resultMode:g.eE.MODE.PUBLIC,maxVotes:g.eE.ANSWER_TYPE.SINGLE}),W=(0,e.EW)(()=>!!s.question&&s.options.filter(p=>!!p).length>=2),Le=(0,e.EW)(()=>m.value?(0,n.t)("spreed","Edit poll draft"):(0,n.t)("spreed","Create new poll")),be=(0,e.EW)(()=>m.value?(0,n.t)("spreed","Save"):y.value!==r.token?(0,n.t)("spreed","Create poll in {name}",{name:f.getters.conversation(r.token)?.displayName??""},void 0,{escape:!1,sanitize:!1}):(0,n.t)("spreed","Create poll")),G=(0,e.EW)({get(){return s.resultMode===g.eE.MODE.HIDDEN},set(p){s.resultMode=p?g.eE.MODE.HIDDEN:g.eE.MODE.PUBLIC}}),Q=(0,e.EW)({get(){return s.maxVotes===g.eE.ANSWER_TYPE.MULTIPLE},set(p){s.maxVotes=p?g.eE.ANSWER_TYPE.MULTIPLE:g.eE.ANSWER_TYPE.SINGLE}}),we=(0,e.EW)(()=>(0,pe.t)(s)),Xe=`Talk Poll ${new Date().toISOString().slice(0,10)}`;function He(p){s.options.splice(p,1)}function Oe(){s.options.push(""),(0,e.dY)(()=>{h.value.at(-1).focus()})}async function Be(){if(m.value){await k.updatePollDraft({token:r.token,pollId:m.value,form:s})&&(N(),(0,e.dY)(()=>{i("close")}));return}await k.createPoll({token:r.token,threadId:c.value?c.value:void 0,form:s})&&i("close")}function Ue(p,E,C){if(E&&(l.value=!0),C==="edit"&&(m.value=p),p===null)return;const R=k.drafts[r.token][p];R&&K({question:R.question,options:[...R.options],resultMode:R.resultMode,maxVotes:R.maxVotes})}function Ye(){M.value.click()}function Ge(p){const E=p.target.files?.[0];if(!E)return;const C=new FileReader;C.onload=R=>{try{const I=ge(JSON.parse(R.target.result));K(I)}catch(I){(0,le.Qg)((0,n.t)("spreed","Error while importing poll")),console.error("Error while importing poll:",I)}},C.readAsText(E)}function K(p){Object.assign(s,p)}async function Qe(){await k.createPollDraft({token:r.token,form:s})}function N(){A.l.emit("poll-drafts-open",{token:r.token,selector:r.container})}function Ke(){N(),l.value&&(0,e.dY)(()=>{i("close")})}return(p,E)=>((0,e.uX)(),(0,e.Wv)((0,t.R1)(L.A),{name:Le.value,"close-on-click-outside":!W.value,container:v.container,"onUpdate:open":E[3]||(E[3]=C=>i("close"))},{actions:(0,e.k6)(()=>[(0,t.R1)(u)?((0,e.uX)(),(0,e.Wv)((0,t.R1)(w.A),{key:0,"force-menu":""},{default:(0,e.k6)(()=>[r.canCreatePollDrafts&&!m.value?((0,e.uX)(),(0,e.Wv)((0,t.R1)(x.A),{key:0,disabled:!W.value,onClick:Qe},{icon:(0,e.k6)(()=>[(0,e.bF)(B.A,{size:20})]),default:(0,e.k6)(()=>[(0,e.eW)(" "+(0,P.v_)((0,t.R1)(n.t)("spreed","Save as draft")),1)]),_:1},8,["disabled"])):(0,e.Q3)("",!0),W.value?((0,e.uX)(),(0,e.Wv)((0,t.R1)(ae.A),{key:1,href:we.value,download:Xe},{icon:(0,e.k6)(()=>[(0,e.bF)((0,t.R1)(H.A),{svg:(0,t.R1)(de),size:20},null,8,["svg"])]),default:(0,e.k6)(()=>[(0,e.eW)(" "+(0,P.v_)((0,t.R1)(n.t)("spreed","Export draft to file")),1)]),_:1},8,["href"])):(0,e.Q3)("",!0)]),_:1})):(0,e.Q3)("",!0),(0,e.bF)((0,t.R1)(D.A),{variant:"primary",disabled:!W.value,onClick:Be},{default:(0,e.k6)(()=>[(0,e.eW)((0,P.v_)(be.value),1)]),_:1},8,["disabled"])]),default:(0,e.k6)(()=>[(0,t.R1)(u)&&l.value?((0,e.uX)(),(0,e.Wv)((0,t.R1)(D.A),{key:0,class:"poll-editor__back-button",variant:"tertiary",title:(0,t.R1)(n.t)("spreed","Back"),"aria-label":(0,t.R1)(n.t)("spreed","Back"),onClick:Ke},{icon:(0,e.k6)(()=>[(0,e.bF)(re.A,{class:"bidirectional-icon",size:20})]),_:1},8,["title","aria-label"])):(0,e.Q3)("",!0),(0,e.Lk)("p",me,(0,P.v_)((0,t.R1)(n.t)("spreed","Question")),1),(0,e.Lk)("div",ke,[(0,e.bF)((0,t.R1)(O.A),{modelValue:s.question,"onUpdate:modelValue":E[0]||(E[0]=C=>s.question=C),label:(0,t.R1)(n.t)("spreed","Ask a question")},null,8,["modelValue","label"]),(0,e.Lk)("input",{id:"poll-upload",ref_key:"pollImport",ref:M,type:"file",class:"hidden-visually",onChange:Ge},null,544),(0,t.R1)(u)?((0,e.uX)(),(0,e.Wv)((0,t.R1)(w.A),{key:0,"force-menu":""},{default:(0,e.k6)(()=>[r.canCreatePollDrafts&&!l.value?((0,e.uX)(),(0,e.Wv)((0,t.R1)(x.A),{key:0,"close-after-click":"",onClick:N},{icon:(0,e.k6)(()=>[(0,e.bF)(B.A,{size:20})]),default:(0,e.k6)(()=>[(0,e.eW)(" "+(0,P.v_)((0,t.R1)(n.t)("spreed","Browse poll drafts")),1)]),_:1})):(0,e.Q3)("",!0),(0,e.bF)((0,t.R1)(x.A),{"close-after-click":"",onClick:Ye},{icon:(0,e.k6)(()=>[(0,e.bF)((0,t.R1)(H.A),{svg:(0,t.R1)(ue),size:20},null,8,["svg"])]),default:(0,e.k6)(()=>[(0,e.eW)(" "+(0,P.v_)((0,t.R1)(n.t)("spreed","Import draft from file")),1)]),_:1})]),_:1})):(0,e.Q3)("",!0)]),(0,e.Lk)("p",Ee,(0,P.v_)((0,t.R1)(n.t)("spreed","Answers")),1),((0,e.uX)(!0),(0,e.CE)(e.FK,null,(0,e.pI)(s.options,(C,R)=>((0,e.uX)(),(0,e.CE)("div",{key:R,class:"poll-editor__option"},[(0,e.bF)((0,t.R1)(O.A),{ref_for:!0,ref_key:"pollOption",ref:h,modelValue:s.options[R],"onUpdate:modelValue":I=>s.options[R]=I,label:(0,t.R1)(n.t)("spreed","Answer {option}",{option:R+1})},null,8,["modelValue","onUpdate:modelValue","label"]),s.options.length>2?((0,e.uX)(),(0,e.Wv)((0,t.R1)(D.A),{key:0,variant:"tertiary","aria-label":(0,t.R1)(n.t)("spreed","Delete poll option"),onClick:I=>He(R)},{icon:(0,e.k6)(()=>[(0,e.bF)(se.A,{size:20})]),_:1},8,["aria-label","onClick"])):(0,e.Q3)("",!0)]))),128)),(0,e.bF)((0,t.R1)(D.A),{class:"poll-editor__add-more",variant:"tertiary",onClick:Oe},{icon:(0,e.k6)(()=>[(0,e.bF)(ie.A)]),default:(0,e.k6)(()=>[(0,e.eW)(" "+(0,P.v_)((0,t.R1)(n.t)("spreed","Add answer")),1)]),_:1}),(0,e.Lk)("p",Pe,(0,P.v_)((0,t.R1)(n.t)("spreed","Settings")),1),(0,e.Lk)("div",Re,[(0,e.bF)((0,t.R1)(X.A),{modelValue:G.value,"onUpdate:modelValue":E[1]||(E[1]=C=>G.value=C),type:"checkbox"},{default:(0,e.k6)(()=>[(0,e.eW)((0,P.v_)((0,t.R1)(n.t)("spreed","Anonymous poll")),1)]),_:1},8,["modelValue"]),(0,e.bF)((0,t.R1)(X.A),{modelValue:Q.value,"onUpdate:modelValue":E[2]||(E[2]=C=>Q.value=C),type:"checkbox"},{default:(0,e.k6)(()=>[(0,e.eW)((0,P.v_)((0,t.R1)(n.t)("spreed","Multiple answers")),1)]),_:1},8,["modelValue"])])]),_:1},8,["name","close-on-click-outside","container"]))}}),Ce=(0,F.A)(ye,[["__scopeId","data-v-6ff4bdf8"]]),Ae=(0,e.pM)({__name:"PollManager",setup(v){const a=(0,S.Pj)(),d=(0,t.KR)(null),r=(0,t.KR)(!1),i=(0,t.KR)(!1),u=(0,t.KR)(void 0),f=(0,t.KR)(""),k=(0,e.EW)(()=>{const{participantType:l,type:m}=a.getters.conversation(f.value)??{};return(0,U.t0)(f.value,"talk-polls-drafts")&&[g._z.TYPE.OWNER,g._z.TYPE.MODERATOR,g._z.TYPE.GUEST_MODERATOR].includes(l)&&[g.si.TYPE.GROUP,g.si.TYPE.PUBLIC].includes(m)});(0,e.sV)(()=>{A.l.on("poll-editor-open",c),A.l.on("poll-drafts-open",y)}),(0,e.xo)(()=>{A.l.off("poll-editor-open",c),A.l.off("poll-drafts-open",y)});function y(l){f.value=l.token,u.value=l.selector,i.value=!0}function c(l){f.value=l.token,u.value=l.selector,r.value=!0,(0,e.dY)(()=>{d.value?.fillPollEditorFromDraft(l.id,l.fromDrafts,l.action),i.value=!1})}return(l,m)=>((0,e.uX)(),(0,e.CE)("div",null,[r.value?((0,e.uX)(),(0,e.Wv)(Ce,{key:0,ref_key:"pollEditorRef",ref:d,token:f.value,"can-create-poll-drafts":k.value,container:u.value,onClose:m[0]||(m[0]=h=>r.value=!1)},null,8,["token","can-create-poll-drafts","container"])):(0,e.Q3)("",!0),k.value&&i.value?((0,e.uX)(),(0,e.Wv)(ne,{key:1,token:f.value,container:u.value,"editor-opened":r.value,onClose:m[1]||(m[1]=h=>i.value=!1)},null,8,["token","container","editor-opened"])):(0,e.Q3)("",!0)]))}});var he=o(37868),Ie=o(53751),De=o(53166),Fe=o(28874),Y=o(43417);const Me=["innerHTML"],We=(0,e.pM)({__name:"InternalSignalingHint",setup(v){const a=(0,S.Pj)(),d=(0,Y.J)(),r=(0,V.N)(),i=(0,e.EW)(()=>[g.si.TYPE.GROUP,g.si.TYPE.PUBLIC].includes(a.getters.conversation(r.value)?.type)),u=(0,t.KR)(!1),f=(0,n.t)("spreed","Calls without High-performance backend can cause connectivity issues and high load on devices. {linkstart}Learn more{linkend}").replace("{linkstart}",'<a target="_blank" rel="noreferrer nofollow" class="external" href="https://portal.nextcloud.com/article/Nextcloud-Talk/High-Performance-Backend/Installation-of-Nextcloud-Talk-High-Performance-Backend">').replace("{linkend}"," \u2197</a>"),k=(0,n.t)("spreed","Talk setup incomplete");(0,e.sV)(()=>{A.l.on("signaling-internal-show-warning",y)}),(0,e.xo)(()=>{A.l.on("signaling-internal-show-warning",y)}),(0,e.wB)(d,c=>{c||(u.value=!1)});function y(){i.value&&(u.value=!0)}return(c,l)=>(0,e.bo)(((0,e.uX)(),(0,e.Wv)((0,t.R1)(De.A),{type:"warning",class:"internal-warning"},{icon:(0,e.k6)(()=>[(0,e.bF)(Fe.A,{"fill-color":"var(--color-warning-text)",size:20})]),default:(0,e.k6)(()=>[(0,e.Lk)("strong",null,(0,P.v_)((0,t.R1)(k)),1),(0,e.Lk)("p",{innerHTML:(0,t.R1)(f)},null,8,Me)]),_:1},512)),[[Ie.aG,u.value]])}}),Se=(0,F.A)(We,[["__scopeId","data-v-ef3773e0"]]);var xe=o(65630),Ve=o(79524);const Ne={name:"FilesSidebarChatView",components:{InternalSignalingHint:Se,CallButton:xe.A,CallFailedDialog:j.A,MediaSettings:J.A,PollManager:Ae,PollViewer:he.A},setup(){return(0,Ve.d)(),{isInCall:(0,Y.J)(),token:(0,V.N)()}},data(){return{recordingConsentGiven:!1}},computed:{connectionFailed(){return this.$store.getters.connectionFailed(this.token)}}},Te=(0,F.A)(Ne,[["render",$],["__scopeId","data-v-756108a4"]])}}]);})();

//# sourceMappingURL=talk-files-sidebar-tab-chunk.js.map?v=cf50f65d2a0a03a6ce69